```{r}
library(httr)
library(jsonlite)
```


```{r}
url = "https://www.fema.gov/api/open/v2/FimaNfipClaims"
res = GET(url)
data = fromJSON(rawToChar(res$content))
df = data$FimaNfipClaims
```

```{r}
getwd()
```
```{r}
file_path = "/Users/dannylam/Desktop/GitHub/ADS-Fall2023-Project2-ShinyApp-Group4/data/FimaNfipClaims.csv"
fima_data = read.csv(file_path)
```

```{r}
head(fima_data)
```
```{r}
cols = c('elevatedBuildingIndicator', 'elevationCertificateIndicator', 'elevationDifference', 'baseFloodElevation')
sub_df = fima_data[, cols]
summary(sub_df)
dim(sub_df)
```
Notes: look at elevation difference with different factors and what that could mean because there are a lot of NA's in other columns

Try to find another column that could correlate well with elevationDifference

look at amount paid on building claim

```{r}
cols = c('elevationDifference', 'baseFloodElevation', 'amountPaidOnBuildingClaim', 'buildingDamageAmount','lowestFloorElevation', 'totalBuildingInsuranceCoverage', 'netBuildingPaymentAmount','occupancyType', 'causeOfDamage')
graph_data = df[, cols]
```


plan: make a shiny interactive scatter plot where you can change the x, y axis and the color as well

x axis: elevation metric

y axis: claim and money related metrics

color: groupings - disaster type etc

```{r}
library(shiny)
library(plotly)
library(dplyr)

x_choices = c('elevationDifference', 'baseFloodElevation', 'lowestFloorElevation')
y_choices = c('amountPaidOnBuildingClaim', 'buildingDamageAmount', 'totalBuildingInsuranceCoverage', 'netBuildingPaymentAmount')
color_choices = c('causeOfDamage', 'occupancyType')
# Define the UI
ui <- fluidPage(
  titlePanel("Interactive Scatter Plot"),
  sidebarLayout(
    sidebarPanel(
      selectInput("x_axis", "X-Axis Variable", choices = x_choices),
      selectInput("y_axis", "Y-Axis Variable", choices = y_choices),
      selectInput("color", "Color Variable", choices = color_choices),
      actionButton("reset", "Reset")
    ),
    mainPanel(
      plotOutput("scatterplot")
    )
  )
)

# Define the server
server <- function(input, output, session) {
  
  # Reactive expression to filter data based on color selection
  filtered_data <- reactive({
    if (input$color == "None") {
      return(graph_data)
    } else {
      return(graph_data[, c(input$x_axis, input$y_axis, input$color)])
    }
  })
  
  # Create the scatter plot
  output$scatterplot <- renderPlot({
    ggplot(filtered_data(), aes_string(x = input$x_axis, y = input$y_axis, color = input$color)) +
      geom_point() +
      labs(x = input$x_axis, y = input$y_axis, color = input$color)
  })
  
  # Reset button action
  observeEvent(input$reset, {
    updateSelectInput(session, "x_axis", selected = NULL)
    updateSelectInput(session, "y_axis", selected = NULL)
    updateSelectInput(session, "color", selected = "None")
  })
}

# Run the Shiny app
shinyApp(ui, server)






```












